<!DOCTYPE html>
<html>
<head>
<style>
	td{text-align:center;}
</style>
<meta charset="ISO-8859-1">
<title>Insert title here</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

</head>
<body>
			
			<!-- Modal -->
<div class="modal fade" id="add" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">REGISTER MODEL</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <form>
			  <div class="mb-3">
			    <label for="exampleInputEmail1" class="form-label">Title</label>
			    <input type="text" class="form-control" id="title" name="title" aria-describedby="emailHelp">
			  </div>
			  
			  <div class="mb-3">
			    <label for="exampleInputEmail1" class="form-label">Number of Copies</label>
			    <input type="text" class="form-control" id="copies" name="copies" aria-describedby="emailHelp">
			  </div>
			  
			  <div class="mb-3">
			    <label for="exampleInputEmail1" class="form-label">Price</label>
			    <input type="text" class="form-control" id="price" name="price" aria-describedby="emailHelp">
			  </div>
			  
			  
			  
			<div class="mb-3"> 
			<label for="exampleInputEmail1" class="form-label">Select Author</label>
			 <select name="cars" id="authors">
			  <option>
			  	<script>
			  
			  	$(document).ready(function(){
					
					$.get('./BookServlet?action=select', function(data){
						
						for(var i=0; i<data.length; i++){
							$('#authors').append('<option>'+data[i].authorName+'</option');
							}
						});
					});
			  	</script>
			  </option>
			</select>
		 </div>
	</form>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button id="btn" type="button" class="btn btn-primary" data-bs-dismiss="modal">Save changes</button>
      </div>
    </div>
  </div>
</div>









			<!-- Modal -->
<div class="modal fade" id="edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">UPDATE MODEL</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <form>
			  <div class="mb-3">
			    <label for="exampleInputEmail1" class="form-label">Title</label>
			    <input type="text" class="form-control" id="bookTitle" name="title" aria-describedby="emailHelp">
			  </div>
			  
			  <div class="mb-3">
			    <label for="exampleInputEmail1" class="form-label">Number of Copies</label>
			    <input type="text" class="form-control" id="numOfCopies" name="copies" aria-describedby="emailHelp">
			  </div>
			  
			  <div class="mb-3">
			    <label for="exampleInputEmail1" class="form-label">Price</label>
			    <input type="text" class="form-control" id="bookPrice" name="bookPrice" aria-describedby="emailHelp">
			  </div>
			  
			  
			  
			<div class="mb-3"> 
			<label for="exampleInputEmail1" class="form-label">Select Author</label>
			 <select name="cars" id="authors1">
			  <option>
			  	<script>
			  
			  	$(document).ready(function(){
					
					$.get('./BookServlet?action=select1', function(data){
						
						for(var i=0; i<data.length; i++){
							$('#authors1').append('<option>'+data[i].authorName+'</option');
							}
						});
					});
			  	</script>
			  </option>
			</select>
		 </div>
	</form>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button id="edit-btn" type="button" class="btn btn-primary" data-bs-dismiss="modal">Save changes</button>
      </div>
    </div>
  </div>
</div>

			
			
			
			
			
			<div class="container">
	
		<div class="jumbotron">
		
			<div class="card">
			  <div class="card-header">
			
			  </div>
			  <div class="card-body">
			    <center><h5 class="card-title">BOOK CRUD</h></center>
			    
			    <div class="row">
			    
			    	<div class="col-md-12">
			    	
			    			<button data-bs-toggle="modal" data-bs-target="#add" style="float:right; width:90px; height:40px; border-radius: 40%;" class="btn btn-success">ADD</button>
			    			<button style="float:left; width:90px; height:40px; border-radius: 40%;" class="btn btn-success"><a href="Home.html" style="color:white; text-decoration: none;">HOME</a></button>
			    	</div>
			    
			    </div>
			    <br>
					<table class="table table-dark ta ble-hover" id="mytable">
					  <thead>
					  
					   	<tr>
					   		<th id="til"style="text-align: center;" scope="col">TITLE</th>
					   		<th style="text-align: center;" scope="col">NO:COPIES</th>
					   		<th style="text-align: center;" scope="col">PRICE</th>
					   		<th style="text-align: center;" scope="col">AUTHOR</th>
					   		<th style="text-align: center;" scope="col" colspan="2">ACTIONS</th>
					   	</tr>
					   	
		 </thead>
				<tbody>
					<script>
					
						$(document).ready(function(){
						
						$.get('./BookServlet?action=getAll', function(data){
							
							for(var i=0; i<data.length; i++){
								$('#mytable').append('<tr><td data-target=name>'+data[i].title+'</td><td data-target=rollno>'+data[i].noOfCopies+'</td><td data-target=rollno>'+data[i].price+'</td><td data-target=rollno>'+data[i].author.authorName+'</td><td><button class="btn btn-danger" style="width:90px; height:40px; border-radius: 40%;" id="deletebtn" data-id='+data[i].bookId+'>Delete</button></td><td><button class="btn btn-success" style="width:90px; height:40px; border-radius: 40%"; data-bs-toggle="modal" data-bs-target="#edit" id="updatebtn" data-id='+data[i].bookId+'>Edit</button></td></tr>');
								}
							});
						});
						
						
						
						
						 $("#btn").click(function(){
								var title=$("#title").val();
								
								var copies=$("#copies").val();
								
								var price=$("#price").val();
								
								var authors=$("#authors").val();
								
								$.post('./BookServlet?action=create',{
									
									"title":$("#title").val(),
									"copies":$("#copies").val(),
									"price":$("#price").val(),
									"authors":$("#authors").val()
								
								},function(success,status)
								{
									$('#mytable tbody').append('<tr><td data-target=title>'+title+'</td><td data-target=noOfCopies>'+copies+'</td><td data-target=price>'+price+'</td><td data-target=author>'+authors+'</td><td><button class="btn btn-danger" style="width:90px; height:40px; border-radius: 40%;" id="deletebtn" data-id='+success.bookId+'>Delete</button></td><td><button  class="btn btn-success" style="width:90px; height:40px; border-radius: 40%"; data-bs-toggle="modal" data-bs-target="#edit" id="updatebtn" data-id='+success.bookId+'>Edit</button></td></tr>');
								
								});
							});
						  
						 
						 
						 
						 
						 
						 
						 
						 $('#mytable').on('click', '#deletebtn', function(){
						 	 $(this).closest('tr').remove();
						 });
						 
				
						 $('#mytable').on('click', '#deletebtn', function(){
							 
							 var sid = $(this).data('id');
											 
							 $.post('./BookServlet?action=delete',{
									
									"id":sid
									
								});
						 });
						 
						 
						 
						 
						 
						 
						 var id;
						 
						 
						 $('#mytable').on('click', '#updatebtn', function(){
								
								
							 
							 var row = $(this).closest('tr');
							 
							 id = $(this).data('id');
							
							 
							var  title = row.find('td:eq(0)').text();
							 $('#bookTitle').val(title);
							  
							var copies = row.find('td:eq(1)').text();
							  $('#numOfCopies').val(copies);
							  
							  var price = row.find('td:eq(2)').text();
							 	$('#bookPrice').val(price);
							
							 
							 var author = row.find('td:eq(3)').text();
							 $('#authors1').val(author);
							 		 
							 
						 });
						 
						 
						 
						 
						 

							$("#edit-btn").click(function(){
							
								
								var title=$("#bookTitle").val();
								
								var copies=$("#numOfCopies").val();
								
								var price=$("#bookPrice").val();
								
								var authors=$("#authors1").val();
								
								
								$.post('./BookServlet?action=update',{
									
									"id":id,		
									
									"title":$("#bookTitle").val(),
									
									"copies":$("#numOfCopies").val(),
									
									"price":$("#bookPrice").val(),
									
									"authors":$("#authors1").val()
									
									
								},function(data,status){
									
									$('#'+id).children('td[data-target=bookTitle]').text(title);
									$('#'+id).children('td[data-target=numOfCopies]').text(copies);
									$('#'+id).children('td[data-target=bookPrice]').text(price);
									$('#'+id).children('td[data-target=authors1]').text(authors);
												
									//$('#mytable').append('<tr><td>'+success.name+'</td><td>'+success.rollno+'</td><td>'+success.age+'</td><td>'+success.email+'</td></tr>');
									
								});
								
							});
						 
						 
					</script>
			 	</tbody>
			 
		</table>
				
			
			
	</div>
</body>
</html>